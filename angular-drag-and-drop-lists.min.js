/**
 * angular-drag-and-drop-lists v2.1.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
!function(e){function n(e,n){return"all"==n?e:e.filter(function(e){return-1!=n.toLowerCase().indexOf(e)})}var a="application/x-dnd",r="application/json",t="Text",d=["move","copy","link"]
e.directive("dndDraggable",["$parse","$timeout",function(e,l){return function(i,g,s){g.attr("draggable","true"),s.dndDisableIf&&i.$watch(s.dndDisableIf,function(e){g.attr("draggable",!e)}),g.on("dragstart",function(f){if(f=f.originalEvent||f,"false"==g.attr("draggable"))return console.debug("dragstart: not draggable"),!0
o.isDragging=!0,o.itemType=s.dndType&&i.$eval(s.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=s.dndEffectAllowed||d[0],f.dataTransfer.effectAllowed=o.effectAllowed
var c=i.$eval(s.dndDraggable),u=a+(o.itemType?"-"+o.itemType:"")
console.debug("dragstart: started",o,c,u)
try{f.dataTransfer.setData(u,angular.toJson(c))}catch(e){var p=angular.toJson({item:c,type:o.itemType})
try{f.dataTransfer.setData(r,p)}catch(e){var v=n(d,o.effectAllowed)
f.dataTransfer.effectAllowed=v[0],f.dataTransfer.setData(t,p)}}if(g.addClass("dndDragging"),l(function(){g.addClass("dndDraggingSource")},0),f._dndHandle&&f.dataTransfer.setDragImage&&f.dataTransfer.setDragImage(g[0],0,0),e(s.dndDragstart)(i,{event:f}),s.dndCallback){var D=e(s.dndCallback)
o.callback=function(e){return D(i,e||{})}}f.stopPropagation()}),g.on("dragend",function(n){n=n.originalEvent||n,i.$apply(function(){var a=o.dropEffect
e(s[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[a]])(i,{event:n}),e(s.dndDragend)(i,{event:n,dropEffect:a})}),o.isDragging=!1,o.callback=void 0,g.removeClass("dndDragging"),g.removeClass("dndDraggingSource"),n.stopPropagation(),l(function(){g.removeClass("dndDraggingSource")},0)}),g.on("click",function(n){s.dndSelected&&(n=n.originalEvent||n,i.$apply(function(){e(s.dndSelected)(i,{event:n})}),n.stopPropagation())}),g.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse",function(e){return function(l,i,g){function s(e){if(!e)return t
for(var n=0;n<e.length;n++)if(e[n]==t||e[n]==r||e[n].substr(0,a.length)==a)return e[n]
return null}function f(e){return o.isDragging?o.itemType||void 0:e==t||e==r?null:e&&e.substr(a.length+1)||void 0}function c(e){return w.disabled?(console.debug("drop not allowed: listSetings is disabled"),!1):w.externalSources||o.isDragging?!w.allowedTypes||null===e||e&&-1!=w.allowedTypes.indexOf(e):(console.debug("drop not allowed: not externalSource and not dragging"),!1)}function u(e,a){var r=d
return a||(r=n(r,e.dataTransfer.effectAllowed)),o.isDragging&&(r=n(r,o.effectAllowed)),g.dndEffectAllowed&&(r=n(r,g.dndEffectAllowed)),r.length?e.ctrlKey&&-1!=r.indexOf("copy")?"copy":e.altKey&&-1!=r.indexOf("link")?"link":r[0]:"none"}function p(){return y.remove(),i.removeClass("dndDragover"),!0}function v(n,a,r,t,d,i){return e(n)(l,{callback:o.callback,dropEffect:r,event:a,external:!o.isDragging,index:void 0!==d?d:D(),item:i||void 0,type:t})}function D(){return Array.prototype.indexOf.call(T.children,b)}var y=function(){var e
return angular.forEach(i.children(),function(n){var a=angular.element(n)
a.hasClass("dndPlaceholder")&&(e=a)}),e||angular.element("<li class='dndPlaceholder'></li>")}()
y.remove()
var b=y[0],T=i[0],w={}
i.on("dragenter",function(e){e=e.originalEvent||e
var n=g.dndAllowedTypes&&l.$eval(g.dndAllowedTypes)
w={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),disabled:g.dndDisableIf&&l.$eval(g.dndDisableIf),externalSources:g.dndExternalSources&&l.$eval(g.dndExternalSources),horizontal:g.dndHorizontalList&&l.$eval(g.dndHorizontalList)}
var a=s(e.dataTransfer.types)
if(!a||!c(f(a)))return console.debug("dragenter: not allowed: ",a),!0
e.preventDefault()}),i.on("dragover",function(e){e=e.originalEvent||e
var n=s(e.dataTransfer.types),a=f(n)
if(!n||!c(a))return console.debug("dragover: not allowed",n),!0
if(b.parentNode!=T&&i.append(y),e.target!=T){for(var r=e.target;r.parentNode!=T&&r.parentNode;)r=r.parentNode
if(r.parentNode==T&&r!=b){var d=r.getBoundingClientRect()
if(w.horizontal)var o=e.clientX<d.left+d.width/2
else var o=e.clientY<d.top+d.height/2
T.insertBefore(b,o?r:r.nextSibling)}}var l=n==t,D=u(e,l)
return"none"==D?p():g.dndDragover&&!v(g.dndDragover,e,D,a)?p():(e.preventDefault(),l||(e.dataTransfer.dropEffect=D),i.addClass("dndDragover"),e.stopPropagation(),!1)}),i.on("drop",function(e){e=e.originalEvent||e
var n=s(e.dataTransfer.types),a=f(n)
if(!n||!c(a))return console.debug("drop not allowed: ",n,a),!0
e.preventDefault()
try{var d=JSON.parse(e.dataTransfer.getData(n))}catch(e){return p()}if((n==t||n==r)&&(a=d.type||void 0,d=d.item,!c(a)))return p()
var i=n==t,y=u(e,i)
if("none"==y)return p()
var b=D()
return g.dndDrop&&!(d=v(g.dndDrop,e,y,a,b,d))?p():(o.dropEffect=y,i||(e.dataTransfer.dropEffect=y),!0!==d&&l.$apply(function(){l.$eval(g.dndList).splice(b,0,d)}),v(g.dndInserted,e,y,a,b,d),p(),e.stopPropagation(),!1)}),i.on("dragleave",function(e){e=e.originalEvent||e
var n=document.elementFromPoint(e.clientX,e.clientY)
T.contains(n)&&!e._dndPhShown?e._dndPhShown=!0:p()})}}]),e.directive("dndNodrag",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}})
var o={}}(angular.module("dndLists",[]))
